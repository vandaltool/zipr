

CC=@CC@
CFLAGS=@CFLAGS@
LIB=@LIB@
AR=@AR@
AS=@AS@
ASFLAGS=@ASFLAGS@
LD=@LD@
LDFLAGS=@LDFLAGS@

OBJS=crt.o

relocatable_obj=callbacks.exe.o


.SUFFIXES: .o .s .c

.c.o:
	$(CC) $(CFLAGS) $(INCLUDE) -D__$(ARCH) -c $<

.s.o:
	$(AS) $(ASFLAGS) $<

all: $(OBJS) $(relocatable_obj)

$(relocatable_obj): $(OBJS) $(LIB)
	$(LD) -Wl,--whole-archive $(LDFLAGS) $(OBJS) $(LIB) -o $@
	objcopy --remove-section .comment callbacks.exe.o
	objcopy --remove-section .note.GNU-stack callbacks.exe.o
	$(LD) -Bstatic -static -T tiny_linker_script -Wl,--whole-archive callbacks.exe.o -nostdlib -o callbacks.exe  -pie

clean:
	rm -f *.o *.a callbacks.exe.o callbacks.exe
	

