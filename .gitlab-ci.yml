before_script:
  - "#### customize per module."
  - "export CICD_MODULE_WORK_DIR=/tmp/work_dir_zipr"
  - "export CICD_SERVER_PREFIX=git@git.zephyr-software.com:"
  - "# boiler plate"
  - "export CICD_SUPPORT_DIR=/tmp/cicd_support"
  - "export CICD_TO_TEST_DIR=$(pwd)"
  - "cd $(dirname $CICD_SUPPORT_DIR); if [[ ! -d $(basename CICD_SUPPORT_DIR) ]]; then git clone ${CICD_SERVER_PREFIX}allnp/cicd_support.git  $(basename $CICD_SUPPORT_DIR); fi"
  - "cd /tmp/cicd_support; git pull ; source set_env; source cicd_support.shinc"
  - "# grab this modules submodules, as committed on the branch"
  - "git submodule sync --recursive "
  - "git submodule update --init --recursive"

after_script:
  - "# boiler plate"
  - "cicd_cleanup"

testing:
  tags:
    - zipr
  script:
    - "# pwd"
    - "# hostname"
    - "# whoami"
    - "# puts peasoup_umbrella (and all submodules) in CICD_MODULE_WORK_DIR"
    - "cicd_setup_module_dependency allnp/peasoup_umbrella.git"
    - "# puts TO_TEST_DIR (the module to test, zipr in this case) in peasoup_umbrella/zipr."
    - "cicd_put_module_in_tree peasoup_umbrella/zipr"
    - "cd $CICD_MODULE_WORK_DIR"
    - "source set_env_vars"
    - "cd zipr"
    - "scons -c"
    - "scons debug=1"

