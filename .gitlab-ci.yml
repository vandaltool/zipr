before_script:
  - "source ~gitlab-runner/cicd_support/cicd_support.shinc" 


after_script:
  - "echo Test Complete."

stages:
  - clean
  - build
  - test



#
# Cleaning
#

#template 
.do-clean: &do-nightly-clean
  stage: clean
  script:
    - ./cicd_tests/do-clean.sh

# per os items
do-nightly-clean-ubuntu18:
  <<: *do-nightly-clean
  tags:
    - ubuntu18
  variables:
    OS: 'ubuntu18'  

do-nightly-clean-ubuntu16:
  <<: *do-nightly-clean
  tags:
    - ubuntu16
  variables:
    OS: 'ubuntu16'  

do-nightly-clean-centos75:
  <<: *do-nightly-clean
  tags:
    - centos75
  variables:
    OS: 'centos75'  


#
# building 
#


# template
.do-build: &do-build
  stage: build
  script:
    - ./cicd_tests/do-build.sh


# per os items
do-build-ubuntu18:
  <<: *do-build
  tags:
    - ubuntu18
  variables:
    OS: 'ubuntu18'  


do-build-ubuntu16:
  <<: *do-build
  tags:
    - ubuntu16
  variables:
    OS: 'ubuntu16'  

do-build-centos75:
  <<: *do-build
  tags:
    - centos75
  variables:
    OS: 'centos75'  



#
# $PSZ ls
#

# template
.xform-ls: &xform-ls
  stage: test
  script:
    - ./cicd_tests/xform-ls.sh

#per OS
xform-ls-ubuntu18:
  <<: *xform-ls
  tags:
    - ubuntu18
  variables:
    OS: 'ubuntu18'  

xform-ls-ubuntu16:
  <<: *xform-ls
  tags:
    - ubuntu16
  variables:
    OS: 'ubuntu16'  

xform-ls-centos75:
  <<: *xform-ls
  tags:
    - centos75
  variables:
    OS: 'centos75'  

#
# $PSZ cat
#

# template
.xform-cat: &xform-cat
  stage: test
  script:
    - ./cicd_tests/xform-cat.sh

xform-cat-ubuntu18:
  <<: *xform-cat
  tags:
    - ubuntu18
  variables:
    OS: 'ubuntu18'  
    
xform-cat-ubuntu16:
  <<: *xform-cat
  tags:
    - ubuntu16
  variables:
    OS: 'ubuntu16'  

xform-cat-centos75:
  <<: *xform-cat
  tags:
    - centos75
  variables:
    OS: 'centos75'  


#
# CFI test_foo
#

# template
.test_foo: &test_foo
  stage: test
  script:
    - ./cicd_tests/test_foo.sh

test_foo-ubuntu18:
  <<: *test_foo
  tags:
    - ubuntu18
  variables:
    OS: 'ubuntu18'

test_foo-ubuntu16:
  <<: *test_foo
  tags:
    - ubuntu16
  variables:
    OS: 'ubuntu16'

test_foo-centos75:
  <<: *test_foo
  tags:
    - centos75
  variables:
    OS: 'centos75'
              

#
# elfdep test
#

# template
.elfdep: &elfdep
  stage: test
  script:
    - ./cicd_tests/elfdep.sh

elfdep-ubuntu18:
  <<: *elfdep
  tags:
    - ubuntu18
  variables:
    OS: 'ubuntu18'  
    
elfdep-ubuntu16:
  <<: *elfdep
  tags:
    - ubuntu16
  variables:
    OS: 'ubuntu16'  

elfdep-centos75:
  <<: *elfdep
  tags:
    - centos75
  variables:
    OS: 'centos75'  
