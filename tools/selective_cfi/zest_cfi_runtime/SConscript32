import os


Import('env')
myenv=env.Clone()
myenv.Replace(SECURITY_TRANSFORMS_HOME=os.environ['SECURITY_TRANSFORMS_HOME'])
myenv.Replace(ZEST_RUNTIME=os.environ['ZEST_RUNTIME'])

cpppath=''' 
	'''


cfiles=Glob( Dir('.').srcnode().abspath+"/*.cpp")
nasmfiles32=Glob( Dir('.').srcnode().abspath+"/*32.s")

CXXFLAGS = " -nostdlib -nostdinc -fno-exceptions -Wall "
CFLAGS = " -nostdlib -nostdinc -fno-exceptions -Wall "
LDFLAGS = " -nostdlib -nostdinc -fno-exceptions -Wall "
AS = "nasm"

myenv.Replace(AS = AS)
myenv.Append(CPPPATH=Split(cpppath))

myenv.Replace(ASFLAGS = " -felf32 " )
myenv.Append(CXXFLAGS = CXXFLAGS+" -m32 ")
myenv.Append(CFLAGS = CFLAGS+" -m32 ")
myenv.Append(LINKFLAGS = LDFLAGS+" -m32 ")


so32=myenv.SharedLibrary("libzestcfi32.so",  cfiles+nasmfiles32)
install32=myenv.Install("$ZEST_RUNTIME/lib32/", so32)
Default(install32)
Return('install32'

	
