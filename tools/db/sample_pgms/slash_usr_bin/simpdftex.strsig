                ;;
# 2003/05/20	Joachim's modification: write first to a pdf file in tmp, 
# 2003/05/21	Joachim's modification used /bin/cp. Gerben made it truly
# 2003/11/23	Added supportfor passing flasg to tex at the request of
# 2004/09/05	Bugfix: make it work better with directories with whitespace
# 2004/11/15	New calling mode: simpdftex format foo.tex
# 2007/05/07	Added dvipdfm support with compatibility with the patched version
# 2007/08/09	Protected echo command against broken builtin versions by running
		able to read files in the outdir unless you also adapt
#		Added calledas variable to hold command basename
#		Added handling of outdir for TeX
#		Added --tex-path to override directory where this script
#		Added version to --help output
#		Added wolfram.map
		Add some debug output
		After running dvips, copy the ps file over to the directory
alternative when using dvips mode. The output for both systems is comparable.
# altpdftex --default is the default setting, it also works
#		and only upon completion copy the file to its final
		an empty path, the path is not changed before the distiller
	# Argument handling
		Argument must be an executable or executable script that
Arguments:
argvbackup="$*"
	argwithoutlead=`/bin/echo -n "$1"|sed 's/^--//'`
#		as dvi file.
	# Assume the command is called altpdf* where the rest is the actual tex
# as the direct call to a filtering gs does not work yet for some reason
		as well.
#		atomic by using /bin/cp in combination with /bin/mv
		at the default resolution.
	basename=`basename "${file}"`
		"${basename}" != "${nosuffixbasename}" ]
#		because a PDF viewer might be tracking the file, and 
		because there exists no known mode for that resolution.
#		before it works on such a system
		beginning.  Thus, installing gs from fink would make
#		beyond the standard map files
	/bin/cp "${pdffile}" "${savedpdffile}.${tmpext}" || \
		/bin/cp "${psfile}" "${savedpsfile}" || \
	/bin/echo "##### Arguments: ${argvbackup}"
			/bin/echo "### Cannot write in current directory and no redirect found. Bailing out..."
	/bin/echo "### Copying/moving pdf file ${pdffile} to ${savedpdffile}"
		/bin/echo "##### Created PDF file: $pdffile"
		/bin/echo "### ${distillerprog} <${psfile} >${pdffile}"
		/bin/echo "### ${distillerprog} ${psfile} ${pdffile}"
		/bin/echo "##### DVI file: $dvifile"
		/bin/echo "##### Environment:"
		/bin/echo "### ERROR: wrong dvipdf mode ${dviprogram}"
#		/bin/echo explicitly. There may exist /bin/echo implementations
		/bin/echo "### FAILED to copy ${pdffile} (${status})"
		{ /bin/echo "### FAILED to generate ${pdffile} (${status})"; \
			{ /bin/echo "### FAILED to generate ${pdffile} (${status})"
		{ /bin/echo "### FAILED to generate ${psfile} (${status})"; \
		/bin/echo "### FAILED to rename ${savedpdffile}.${tmpext} (${status})"
			/bin/echo "### FAILED to save ${psfile} (${status})"
		/bin/echo "##### Final PDF file: $savedpdffile"
			/bin/echo "##### PATH set to ${PATH}"
			/bin/echo "##### PS file: $psfile"
			/bin/echo "##### Saved PS file: $savedpsfile"
		/bin/echo "### Saving intermediary ps file ${psfile} as ${savedpsfile}"
		/bin/echo "simpdftex Empty argument: tex-or-dvi-file-name"
		/bin/echo "### Skipping ${texprogram} ${texfile} [dvi->pdf only]"
			/bin/echo "### Succesfully generated ${dvifile} and ${savedpdffile}"
			/bin/echo "### Succesfully generated ${dvifile}, ${savedpdffile} and ${savedpsfile}"
			/bin/echo "### Succesfully generated ${savedpdffile}"
			/bin/echo "### Succesfully generated ${savedpdffile} and ${savedpsfile}"
		/bin/echo "##### TeX file: $texfile"
	/bin/echo "### ${texpath}/${dviprogram} ${dvipdfmoptions} -o ${pdffile} ${dvifile}"
	/bin/echo "### ${texpath}/${dviprogram} -R ${dvipsoptions} ${extradvipsoptions} -o ${psfile} ${dvifile}"
		/bin/echo "### ${texpath}/${texprogram} ${texfile}"
	/bin/echo "### This is $0, Version ${version}"
	/bin/echo "##### This is $0, Version ${version}"
			/bin/echo "Unknown mode $1"
		/bin/echo "Unknown option $1"
			/bin/echo "### WARNING: TeX returned non zero exit status ${status}"
	/bin/mv "${savedpdffile}.${tmpext}" "${savedpdffile}" || \
	/bin/rm -f "${savedpdffile}"
#!/bin/sh
		break;;
# BUG: Handling of file name extensions is not completely equialent to TeX
		calledas="altpdf${formatname}"
calledas=`basename "$0"`
		called with the PS input as standard input and which writes
# cannot be used to remove a map from the standard list
	case $1 in
	case "${dviprogram}" in
	cat <<_eof_help
		cd "$1"
#		Changed distiller semantics
#		Changed dviopts to dvipsopts (better name)
#		Changed --gs-path to --distiller-path
#		Changed version string to date-based string
	cleanup
cleanup()
		Compatibility flag with simpdftex_dpmx. Equal to --mode dvipdfm
		Compatibility flag with simpdftex_dpmx. Equal to --mode dvipdfmx
		config.pdf. For file contents (not name) equivalent to
# COPYRIGHT Gerben Wierda 2001--2004
# Created by Gerben Wierda, May 2001
	--debug
	--debug)
debug="no"
#		Debug option
		debug="yes"
	--default
	--default)
# Default distiller is ps2pdf from /usr/local/bin in no filter mode
	[--default] [--maxpk] [--maxpfb] [--extendedname] [--no-echo-version]
# Defaults:
		definition config.ps. For file contents (not name) equivalent
depending on the flags. See below.
		Depending on the mode, adds intermediary extensions to the
#		destination.  This is done in order to minimise the time where
#		Dick Koch.
		differently. The current dir becomes the value of --outdir and
#		directory /usr/local/bin. Also, force gs directory at the
#		display a blank page until the new version is ready.
		Display this message and exit
	--distiller)
	--distiller-filter)
		distillerfilter="no"
distillerfilter="no"
	--distiller-filter prog
		--distiller-filter=u-psbuild
#distillerfilter="yes"
		distillerfilter="yes"
#distillerpath=""
	--distiller-path
	--distiller-path)
		distillerpath="$1"
distillerpath="/usr/local/bin"
	--distiller prog
		distillerprog="$1"
	[--distiller prog] [--distiller-filter prog] [--help]
distillerprog="ps2pdf13"
		"${distillerprog}" <"${psfile}" >"${pdffile}" || \
		"${distillerprog}" "${psfile}" "${pdffile}" || \
#distillerprog="/usr/local/bin/gs -dCompatibility=1.3 -q -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -sOutputFile=- -c save pop"
		--distiller=pstill
		--distiller=/usr/local/alternate/bin/ps2pdf
		Do not echo location and version of this script. Does not exit
        --dpm)	# Compatibility with simpdftex_dpmx
        --dpx)	# Compatibility with simpdftex_dpmx
		dvifile="${file}"
		dvifile="${outdir}${nosuffixbasename}.dvi"
	- dvipdfm
	"dvipdfm")
		- dvipdfm
dvipdfmoptions=""
		dvipdfmoptions="$1"
	--dvipdfmopts
	--dvipdfmopts)
		--dvipdfmopts "-c"
	[--dvipdfmopts dvipdfmoptstring] tex-or-dvi-file
	- dvipdfmx
	"dvipdfmx")
		- dvipdfmx
dvipdfmx to turn the DVI file into PDF. There is finegrained control over the
        --dvipdfopts)	# Compatibility with simpdftex_dpmx
			dviprogram="$1"
                dviprogram="dvipdfm"
                dviprogram="dvipdfmx"
dviprogram="dvips" # Might be dvips, dvipdfm or dvipdfmx
	"dvips")
		- dvips
	- dvips + a distiller like ghostscript
		dvips="dvips"
		dvips="odvips"
		dvipsoptions=""
		dvipsoptions="$1"
		dvipsoptions="$maxpfbdvipsopts"
dvipsoptions="$maxpfbdvipsopts"
		dvipsoptions="$maxpkdvipsopts"
		dvipsoptions="-P pdf"
	--dvipsopts
	--dvipsopts)
	[--dvipsopts dvipsoptstring] [--extradvipsopts dvipsoptstring] [--pdf]
		--dvipsopts "-M"
		--dvipsopts "" --noextendedname
		--dvipsopts "-Poutline"
		--dvipsopts "-Ppdf"
		--dvipsopts "-Ppk"
Dvips will call Metafont to produce bitmaps or include PostScript .pfb files
		echoversion="no"
#		Echo version on by default
echoversion="yes"
#		e.g.:
		env | sed 's/^/##### /g'
_eof_help
# EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
# EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
		exit 0;;
		  exit 1; }
			  exit 1; }
			exit 1
		exit 1
		exit 1;;
	exit 1;
		export TEXINPUTS=`pwd`:`kpsewhich --expand-var '$TEXINPUTS'`
				export TEXINPUTS=${TEXMFOUTPUT}:`kpsewhich --expand-var '$TEXINPUTS'`
		export TEXMFOUTPUT="$1"
		--extendedfilename has been set. Use standard printer
	--extendedname
	--extendedname)
		--extendedname has been set. Use printer definition
extradvipsoptions=""
		extradvipsoptions="$1"
	--extradvipsopts
	--extradvipsopts)
		--extradvipsopts "-M"
		extratexoptions="$1"
	--extratexopts
	--extratexopts)
		--extratexopts "--interaction=nonstopmode"
# FEATURE: it seems -u +foo.map -u -foo.map does not work. So --extradvipsopts
		file (PDF). E.g.:
		Filter mode: "${distillerfilter}"
		find gs and sets the path to something with /sw/bin at the
#		Fixed bug --tex-path flag needed trailing '/'
for altpdftext by config.ps (unless --pdf is given).
		for bitmaps and bitmap generation fails at this resolution
	# Force removal of possible existing tmpdir
#		for determining format below also works when there is no dir
		For file contents (not name) equivalent to:
for file in "$@"
		formatname="$1"
		for the default printer resolution. This options produces
		gets called iwth two arguments: input file (PS) and output
		Give arbitrary arguments to dvipdfm or dvipdfmx, e.g.
		Give arbitrary arguments to dvips, e.g.
		Give extra arbitrary arguments to dvips, e.g.
		Give extra arbitrary arguments to tex, e.g.
		Give path needed by the distiller binary. This path is added
		Give path of TeX binaries, use directory of this script
	# Handle temp dir (cleanup is called on signal)
	--help)
# Hint: Give all extensions explicitely on the command line
# However, if you change it you should note in this file that you did and who
# $Id: altpdftex,v 2.18 2004/11/15 20:36:11 gerben Exp $
# i.e. foo.bar.bla gets you foo.bar.pdf not foo.bar.bla.pdf
	if [ "$1" != "" -a "$1" = "${argwithoutlead}" ]
		if [ "$1" = "dvips" -o "$1" = "dvipdfm" -o "$1" = "dvipdfmx" ]
		If a .dvi file is given, skip the TeX process. Otherwise, TeX
		If any font is included as TeX pk bitmap, it is rendered
			if [ "${autoinput}" = "yes" ]
if [ "${calledas}" = "simpdftex" ]
	if [ "${debug}" = "yes" ]
if [ "${debug}" = "yes" ]
		if [ "${debug}" = "yes" ]; then
	if [ "${distillerfilter}" = "yes" ]; then
	if [ "${distillerpath}" != "" ]; then
		if [ "${dviprogram}" = "dvips" ]
if [ "${echoversion}" = "yes" -a "${debug}" = "no" ]
	if [ "${file}" = "" ]
#		if it finds the pdf file in an intermediate state it will
		if [ "${keeppsfile}" = "yes" ]; then
	if [ "${keeppsfile}" = "yes" ]; then
	if [ "${nodvisuffixbasename}" = "${nosuffixbasename}" -a \
	if [ "${simplename}" = "yes" ]
	if [ "${startwithdvi}" = "yes" ]
	if [ "${startwithdvi}" = "yes" ]; then
		if [ "${TEXMFOUTPUT}" != "" ]
	if [ "${texprogram}" = "omega" -o "${texprogram}" = "lambda" ]
	if [ "${tmpdir}" != "" -a "${debug}" = "no" ]
	if [ ! -w "." ]
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
#		in names, also internally
in other words, "pdftex file.tex" and "altpdftex file.tex" both produce an
intermediary file.
#		In the future, the old modes (altpdflatex and friends) through
#		in their name
# I will not get support questions for software that is not entirely mine.
	--keep-psfile
	--keep-psfile)
keeppsfile="no"
		keeppsfile="yes"
	kpsefilename=`kpsewhich "${file}"`
	Later flags override settings of earlier flags.
# LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
# LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	# Make new version
	--maxpfb
	--maxpfb)
maxpfbdvipsopts="-Poutline"
# maxpfbdvipsopts: use as many pfb's as possible
		--maxpfb, .maxpfb is added. Example:
	--maxpk
	--maxpk)
maxpkdvipsopts="-Ppk"
# maxpkdvipsopts: use only pfb's for real PS fonts, bitmaps are default for the others
# MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO
		mimicks the TEXMFOUTPUT environment variable of TeX, but
	mkdir "${tmpdir}"
	--mode)
# Modified by Gerben Wierda, April 2007
# Modified by Joachim Kock, May 2003
# NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
	nodvisuffixbasename=`/bin/echo -n ${basename}|sed 's/\.[dD][vV][iI]$//'`
	--no-echo-version
	--no-echo-version)
	nosuffixbasename=`/bin/echo -n ${basename}|sed 's/\.[^.]*$//'`
		Note that the default config.pdf assumes resolution 8000
		Not yet functional for the other modes.
		of the options for dvips
opt_dvipsopts=""
		optimal results for the chosen printer.
		optimal results for the screen.
		or override other options. Options will be added to the end
		otherwise
	--outdir)
		outdir="$1/"
	--outdir dir
	[--outdir dir] [--extratexopts texoptsstring]
			outdirset="yes"
		outdirset="yes"
			outdir="${TEXMFOUTPUT}/"
output file file.pdf. For pdftex, output options are controlled by pdftex.cfg,
		output filename. If the mode is --pdf, .pdfmode is added. If
		outputpostfix=""
		outputpostfix=".custom"
		outputpostfix=".maxpbfb"
outputpostfix=".maxpfb"
		outputpostfix=".maxpk"
		outputpostfix=".pdfmode"
		overrides other flags that set dvipdfmopts.
		overrides other flags that set dvipsopts.
		Path addition: "${distillerpath}"
		PATH="${distillerpath}:${PATH}";export PATH
	pdffile="${tmpdir}/${nosuffixbasename}${outputpostfix}.pdf"
PostScript and uses gs to produce pdf (with ps2pdf). Or it uses dvipdfm or
		PostScript fonts. All other fonts are included as bitmaps
		PostScript fonts (like Times Roman) are included as
# PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
		Program: "${distillerprog}"
		program is run. The default is empty.
	# program to be run
#		ps2pdf is affected
	psfile="${tmpdir}/${nosuffixbasename}${outputpostfix}.ps"
#		removed --auto-outdir
#		Removed dependencies on smart sh versions
#		resides. Added --gs-path to override a new default gs
resulting filename and the options with which dvips produces the PostScript
		resulting ps file
# Rewritten by Gerben Wierda, January 2002
		rm -rf "${tmpdir}"
		run_dvipdfm;;
run_dvipdfm()
		run_dvips;;
run_dvips()
#		(run from dir where altpdftex resides, not very likely...)
		run. The reason is that for instance ps2pdf uses the path to
	savedpdffile="${outdir}${nosuffixbasename}${outputpostfix}.pdf"
	savedpsfile="${outdir}${nosuffixbasename}.ps"
		Select no extension for the output file name, even if
		Select .pdfmode extension for the output file name if
		Sets extension for --extendedfilename to .custom. --dvipdfmopts
		Sets extension for --extendedfilename to .custom. --dvipsopts
		Sets extra options for dvips and does not set extension
		Sets extra options for the tex command that is used.
simpdftex compiles the file with {LA}TeX, processes the DVI file with dvips into
simpdftex is a way to do pdf{e}{la}tex without having pdf{e}{la}tex. It needs a
#			simpdftex latex foo.tex
		simplename="no"
simplename="yes"
#		Simplified different format support
Since pdf{e}{la}tex cannot handle insertion of .eps graphics, simpdftex gives an
	slashdirname=`dirname "${kpsefilename}"`/
		so can be used tochange info to the output of a real run
#		Some extra quoting to be more robust for whitespace
#		start of the path to repair for broken installations of
	startwithdvi="no"
		startwithdvi="yes"
#		still work.
#		switch, inside while to prevent subscript out of range error
#		symlinks will disappear from my distribution, though they will
		Tell simpdftex how to go from DVI to PDF. There are three modes:
terminated()
		texfile="${file}"
#		TeX, gs and such
		TEXINPUTS.
	tex-or-dvi-file
			tex-or-dvi-file-basename.maxpfb.pdf
	--tex-path
	--tex-path)
		texpath="$1"
	[--tex-path dir] [--keep-psfile] [--distiller-path dir] [--debug]
texpath=`dirname "$0"`
	"${texpath}/${dviprogram}" ${dvipdfmoptions} -o "${pdffile}" "${dvifile}" || \
	"${texpath}/${dviprogram}" -R ${dvipsoptions} ${extradvipsoptions} -o "${psfile}" "${dvifile}" || \
		"${texpath}/${texprogram}" ${extratexoptions} "${texfile}" || \
	texprogram=`/bin/echo ${calledas}|sed 's/altpdf//'`
#		that do not support -n and this script will have to be changed
#		that is available on the net (simpdftex_dpmx)
		that is there. Use with caution, a ps file could be input
# the bitmap mode to something large but realistic (real mode) so that
The default setting is normal name, maximal use of pfb's, just like pdf{la}tex,
	The defaults for the distiller are
		the directory where the old current dir is added to TEXINPUTS.
		the input file, dvips the resulting dvi file and ps2pdf the
		the mode is --maxpk, ,maxpk is added and if the mode is
#		the pdf file in current directory is in an unstable state,
		the PDF output to standard output. E.g.:
#		the process group (the negative PID) to get it to work
#		These notes here will become a ChangeLog.
#		the wrong variable
# This file is free software. You are free to use this file in any way you like
		This flag only makes sense in dvips mode
		This is more robust for reading and locating files.
This is simpdftex, $version
#		this script
# This script assumes that there is a config.pdf somewhere that sets
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED
#		This version works, but you need to send the SIGTERM to
	tmpdir="/tmp/altpdf${texprogram}.${tmpext}"
	tmpext=$$-`/bin/date +"%s"`
		to the begin of you PATH environment before the distiller is
trap 'terminated' 15
# unavailable pfb fonts will be included as bitmaps.
unset outdir
Usage: simpdftex formatname [--mode modestring]
		Use a distiller different from ps2pdf which is the default.
		Use a distiller executable or executable script which is
		Use Metafont bitmaps (pk files) when possible. Only real
		Use PostScript pfb files whenever possible. This produces
		# Use the default print option in config.ps
		Using this flag sets the distiller filter mode to off
		/usr/local/bin/ps2pdf find another gs than intended. By giving
# Version 1.0a:	Cosmetic change: do not display dir of argv[0] all the time
# Version 1.0:	added the string above for identification purposes
# Version 1.10:	Added amstex support
# Version 1.11:	Do not source ~/.{t}cshrc, use the environment 'as is'
#		Version 1.11 says it is version 1.10!
# Version 1.12: Added textrace bold font (textrace 0.48 is ok)
# Version 1.13b:Date report on version was very out of date, removed
# Version 1.13:	Changed success message at the end
# Version 1.1:	Use calledas instead of $0 which means the sed command
# Version 1.2:	Force the use of tex binaries from the same directory as
# Version 1.3:  Added --echo-version option, placed argument check after
# Version 1.4:	Moved path changes to just before calling gs so that only
# Version 1.5a:	Missing ${extradviopts} from echo
# Version 1.5:	Removed some path-related redundancy from GS calling
# Version 1.6:	Fixed bug: --dviopts did not work because it did set
# Version 1.7:	Added --distiller and --distiller-filter option
# Version 1.8:	Added pstill and u-psbuild info to help
# Version 1.9:	Removed textrace bbold font (textrace is broken)
version='20070809'
# Version 2.0:	Rewritten in /bin/sh because (t)csh does not handle signals
# Version 2.10:	Changed --outdir behaviour to mimick TEXMFOUTPUT,
# Version 2.11:	Fixed typo
# Version 2.12:	RCS changes, from now on, the version number is the RCS number
# Version 2.1:	Small bug fixes
# Version 2.2:	Fixed bug where argument without extension was interpreted
# Version 2.3:	Removed map file knowledge (needs to be outside this script)
# Version 2.4:	Added support for omega and lambda (use odvips)
# Version 2.5:	Changed maxpk and maxpfb implementation to recent updmap
# Version 2.6:	Use ps2pdf13 as the default distiller
# Version 2.7:	Changed help
# Version 2.8:	Checked into CVS.
# Version 2.9:	Added auto-outdir flag
#		very well...
# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
# when there is no config.pdf file
		where the tex file is, possibly overwriting a ps file
while test $# -gt 0
working TeX environment and one of three ways to turn  DVI file into PDF:
		Write files here *if* our current directory is unwritable. This
# you are, you also need to change the version string if you do. That way
		You can also set TEXMFOUTPUT instead, but with a disadvantage:
		you will be running TeXin the current dir. And you will not be
