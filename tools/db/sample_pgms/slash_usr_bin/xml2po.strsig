#   1.0.* are unstable, development versions
#   1.1 will be first stable release (release 1), and 1.1.* bugfix releases
#   2.0.* will be unstable-feature-development stage (milestone 1)
#   2.1.* unstable development betas (milestone 2)
#   2.2 second stable release (release 2), and 2.2.* bugfix releases
# 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
    -a    --automatic-tags     Automatically decides if tags are to be considered
    After translating book.pot into de.po, merge the translations back,
# along with xml2po; if not, write to the Free Software Foundation, Inc.,
# (at your option) any later version.
                               ['automatic-tags','version', 'help', 'keep-entities', 'expand-all-entities', 'mode=', 'translation=',
# but WITHOUT ANY WARRANTY; without even the implied warranty of
    chapter2.xml, run the following:
        %(command)s -o book.pot chapter1.xml chapter2.xml
        %(command)s -p de.po chapter1.xml > chapter1.de.xml
        %(command)s -p de.po chapter2.xml > chapter2.de.xml
""" % {'command': sys.argv[0]}
# Copyright (c) 2004, 2005, 2006 Danilo 
# Copyright (c) 2009 Claude Paroz <claude@2xlibre.net>.
            default_mode = arg
            default_mode = 'basic'
    default_mode = 'docbook'
    # Default parameters
def main(argv):
def usage (with_help = False):
    -e    --expand-all-entities  Expand ALL entities (including SYSTEM ones)
egan <danilo@gnome.org>.
    elif operation == 'update':
        elif opt in ('-e', '--expand-all-entities'):
        elif opt in ('-h', '--help'):
        elif opt in ('-k', '--keep-entities'):
        elif opt in ('-l', '--language'):
        elif opt in ('--mark-untranslated',):
        elif opt in ('-o', '--output'):
        elif opt in ('-p', '--po-file'):
        elif opt in ('-r', '--reuse'):
        elif opt in ('-t', '--translation'):
        elif opt in ('-u', '--update-translation'):
        elif opt in ('-v', '--version'):
    elif origxml:
    else:
# -*- encoding: utf-8 -*-
EXAMPLES:
    except getopt.GetoptError:
    except IOError:
        'expand_all_entities' : False,
        'expand_entities'     : True,
    filenames = []
        filenames.append(remaining_args.pop())
                                 "final" or not
    for opt, arg in opts:
    from xml2po import Main
# GNU General Public License for more details.
    -h    --help               Output this message
        if len(filenames) > 1:
    if mofile_tmppath:
if __name__ == '__main__':
    if not argv:
        if not mofile:
if not os.path.exists('/dev/null'): NULL_STRING = 'NUL'
    if operation == 'merge':
    if operation == 'update' and output != "-":
        if opt in ('-a', '--automatic-tags'):
        if opt in ('-m', '--mode'):
    if os.path.exists(os.path.join(name, 'tests')):
            if 'translationlanguage' not in options:
    if with_help:
import getopt
import os
import sys
import tempfile
# it under the terms of the GNU General Public License as published by
    -k    --keep-entities      Don't expand entities
    -l    --language=LANG      Set language of the translation to LANG
# Main program start
    main(sys.argv[1:])
        'mark_untranslated'   : False,
          --mark-untranslated  Set 'xml:lang="C"' on untranslated tags
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    -m    --mode=TYPE          Treat tags as type TYPE (default: docbook)
            mofile = arg
            mofile_handle, mofile_tmppath = tempfile.mkstemp()
            mofile = mofile_tmppath
    mofile = None
    mofile_tmppath = None
    name = os.path.join(os.path.dirname(__file__), '..')
NULL_STRING = '/dev/null'
    -o    --output=FILE        Print resulting text (XML or POT) to FILE
            operation = 'merge'
    operation = 'pot' # 'pot', 'merge', 'update'
            operation = 'update'
    options = {
            options['expand_all_entities'] = True
            options['expand_entities'] = False
            options['mark_untranslated'] = True
OPTIONS may be some of:
            options['translationlanguage'] = arg
                options['translationlanguage'] = os.path.split(os.path.splitext(mofile)[0])[1]
                options['translationlanguage'] = os.path.split(os.path.splitext(pofile)[0])[1]
    origxml = ''
            origxml = arg
            os.close(mofile_handle)
        os.remove(mofile_tmppath)
            os.system("msgfmt -o %s %s >%s" % (mofile_tmppath, pofile, NULL_STRING)) and sys.exit(7)
            output = arg
                                'output=', 'po-file=', 'update-translation=', 'reuse=', 'language=', 'mark-untranslated' ])
    output  = '-' # this means to stdout
            pofile = arg
            po_to_update = arg
    -p    --po-file=FILE       Specify PO file containing translation, and merge
        print >> sys.stderr, """
        print >> sys.stderr, "Error: cannot open file %s for writing." % (output)
            print  >> sys.stderr, "Error: You can merge translations with only one XML file at a time."
            print >> sys.stderr, "Error: You must specify MO file when merging translations."
        print >> sys.stderr, "Option '-o' is not yet supported when updating translations directly. Ignoring this option."
        print >> sys.stderr, 'Running from source folder, modifying PYTHONPATH'
    print >> sys.stderr, "Usage:  %s [OPTIONS] [XMLFILE]..." % (sys.argv[0])
            print VERSION
    raise NotImplementedError
    -r    --reuse=FILE         Specify translated XML file with the same structure
        # Standard POT producing
            sys.exit(0)
            sys.exit(2)
        sys.exit(2)
            sys.exit(3)
        sys.exit(5)
        sys.path.insert(0, name)
# the Free Software Foundation; either version 2 of the License, or
# This file is part of xml2po.
# those Linux-versioning-scheme addicts):
    To create a POTemplate book.pot from input files chapter1.xml and
    # Treat remaining arguments as XML files
    try:
    try: opts, remaining_args = getopt.getopt(argv, 'avhkem:t:o:p:u:r:l:',
    -t    --translation=FILE   Specify MO file containing translation, and merge
        usage()
            usage(True)
        usage(True)
    using -p option for each XML file:
#!/usr/bin/python
    -u    --update-translation=LANG.po   Updates a PO file using msgmerge program
VERSION = "0.20.10"
# Versioning system (I use this for a long time, so lets explain it to
    -v    --version            Output version of the xml2po program
    while remaining_args:
# xml2po is distributed in the hope that it will be useful,
# xml2po is free software; you can redistribute it and/or modify
        xml2po_main = Main(default_mode, operation, output, options)
        xml2po_main.merge(mofile, filenames[0])
        xml2po_main.reuse(origxml, filenames[0])
        xml2po_main.to_pot(filenames)
        xml2po_main.update(filenames, po_to_update)
# xml2po -- translate XML documents
# You should have received a copy of the GNU General Public License
