                            (
                            )
                        )
                      }
         ]
# along with this program; if not, write to the Free Software
# (at your option) any later version.
# Author: Don Welch
         ("", "<bus>: cups, usb\*, net, bt, fw, par (\*default) (Note: bt and fw not supported in this release.)", "option", False),
                bus = ['net']
    bus = None
         ("Bus to probe:", "-b<bus> or --bus=<bus>", "option", False),
        bus = tui.connection_table()
                bus = ['usb']
                bus = [x.lower().strip() for x in a.split(',')]
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# (c) Copyright 2003-2009 Hewlett-Packard Development Company, L.P.
        cleanup_spinner()
# -*- coding: utf-8 -*-
                      'copy': 'copy-type',
        devices = device.probeDevices([b], timeout, ttl, filter_dict, search, method)
__doc__ = "Discover HPLIP supported USB, parallel, and network attached printers."
            elif b in ('usb', 'par', 'cups'):
        elif o in ('-e', '--filter'):
        elif o in ('-m', '--method'):
        elif o in ('-o', '--timeout', '--time-out'):
        elif o in ('-s', '--search', '--find'):
        elif o in ('-t', '--ttl'):
            else:
        else:
except KeyboardInterrupt:
            except TypeError:
            except ValueError:
                      'fax': 'fax-type',
    filter = []
         ("Filter by functionality:", "-e<filter list> or --filter=<filter list>", "option", False),
        filter_dict = {}
                filter_dict[FILTER_MAP[f]] = (operator.gt, 0)
                filter_dict[f] = (operator.gt, 0)
         ("", "<filter list>: comma separated list of one or more of: scan, pcard, fax, copy, or none\*. (\*none is the default)", "option", False),
        FILTER_MAP = {'print' : None,
            filter = [x.strip().lower() for x in a.split(',')]
         ("Find all devices on the network:", "hp-probe -bnet", "example", False),
         ("Find all devices on the USB bus:", "hp-probe", "example", False),
         ("Find all devices on USB that support scanning:", "hp-probe -busb -escan", "example", False),
         ("Find all devices that have queues installed in CUPS:", "hp-probe -bcups", "example", False),
         ("Find all networked devices that contain the name 'lnx' and that support photo cards or scanning:", "hp-probe -bnet -slnx -escan,pcard", "example", False),
    for b in bus:
                for d in devices:
            for d in devices:
        for f in filter:
                formatter = utils.TextFormatter(
    for o, a in opts:
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
from base.g import *
from base import device, utils, tui, module
# GNU General Public License for more details.
                          handle_device_printer=False)
            if b == 'net':
        if b == 'net':
        if bus is None:
    if bus is None:
        if devices:
            if f in FILTER_MAP:
            if method not in ('slp', 'mdns', 'bonjour'):
            if not device.validateBusList(bus):
            if not device.validateFilterList(filter):
        if o in ('-b', '--bus'):
            if timeout < 0:
                if timeout > 45:
import getopt
import operator
import os
import sys
                        (INTERACTIVE_MODE,))
# it under the terms of the GNU General Public License as published by
        log.debug(filter_dict)
                log.error("Invalid bus: %s" % b)
    log.error("User exit")
        log.info("")
log.info("")
log.info("Done.")
                    log.info(formatter.compose((d, devices[d][0])))
                    log.info(formatter.compose((d, devices[d][0], devices[d][2])))
                log.info(formatter.compose(("Device URI", "Model")))
                log.info(formatter.compose(("Device URI", "Model", "Name")))
                log.info(formatter.compose(('-'*max_c1, '-'*max_c3)))
                log.info(formatter.compose(('-'*max_c1, '-'*max_c3, '-'*max_c4)))
            log.info(log.bold("Probing network for printers. Please wait, this will take approx. %d seconds...\n" % timeout))
            log.info("\nFound %d printer(s) on the '%s' bus.\n" % (len(devices), b))
        log.info("\nUsing connection type: %s" % bus[0])
                    log.note("Timeout > 45secs. Setting to 45secs.")
                log.note("Timeout value error. Timeout set to default of 5secs.")
                log.note("TTL value error. TTL set to default of 4 hops.")
                log.warn("check to make sure your devices are properly connected and powered on.")
                log.warn("check your network connections and make sure your internet")
                log.warn("firewall software is disabled.")
            log.warn("No devices found on the '%s' bus. If this isn't the result you are expecting," % b)
        max_c1, max_c2, max_c3, max_c4 = 0, 0, 0, 0
                max_c1 = max(len(d), max_c1)
                max_c3 = max(len(devices[d][0]), max_c3)
                max_c4 = max(len(devices[d][2]), max_c4)
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
            method = a.lower().strip()
    method = 'slp'
                          'method=', 'time-out=', 'timeout=', 'bus='],
__mod__ = 'hp-probe'
    mod = module.Module(__mod__, __title__, __version__, __doc__, USAGE,
        mod.parseStdOpts('b:t:o:e:s:m:',
                mod.usage(error_msg=['Invalid bus name'])
                mod.usage(error_msg=["Invalid network search protocol name. Must be 'slp' or 'mdns'."])
                mod.usage(error_msg=["Invalid term in filter"])
                mod.usage(error_msg=["You must specify a positive timeout in seconds."])
         ("Network discovery method:", "-m<method> or --method=<method>: <method> is 'slp'* or 'mdns'.", "option", False),
                      'none' : None,
    opts, device_uri, printer_name, mode, ui_toolkit, loc = \
                      'pcard': 'pcard-type',
                      'scan': 'scan-type',
    search = ''
            search = a.lower().strip()
         ("", "<search re> must be a valid regular expression (not case sensitive)", "option", False),
         ("Search:", "-s<search re> or --search=<search re>", "option", False),
         ("Set timeout:", "-o<timeout in secs.> or --timeout=<timeout is secs.>", "option", False),
         ("Set Time to Live (TTL):", "-t<ttl> or --ttl=<ttl> (Default is 4).", "option", False),
# Std Lib
            sys.exit(0)
# the Free Software Foundation; either version 2 of the License, or
# This program is distributed in the hope that it will be useful,
# This program is free software; you can redistribute it and/or modify
    timeout=10
                    timeout = 45
                timeout = 5
                timeout = int(a)
__title__ = 'Printer Discovery Utility'
            try:
                ttl = 4
    ttl=4
                         ['ttl=', 'filter=', 'search=', 'find=',
                ttl = int(a)
    tui.header("DEVICE DISCOVERY")
USAGE = [(__doc__, "", "name", True),
         ("Usage: %s [OPTIONS]" % __mod__, "", "summary", True),
#!/usr/bin/python
         utils.USAGE_EXAMPLES,
         utils.USAGE_HELP,
         utils.USAGE_LOGGING1, utils.USAGE_LOGGING2, utils.USAGE_LOGGING3,
         utils.USAGE_OPTIONS,
         utils.USAGE_SPACE,
__version__ = '4.1'
                                {'width': max_c1, 'margin' : 2},
                                {'width': max_c3, 'margin' : 2},
                                {'width': max_c4, 'margin' : 2},
# You should have received a copy of the GNU General Public License
