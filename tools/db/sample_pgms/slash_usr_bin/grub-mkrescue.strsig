# along with GRUB.  If not, see <http://www.gnu.org/licenses/>.
argument () {
# (at your option) any later version.
bindir="${exec_prefix}/bin"
#! /bin/sh
# build BIOS core.img
    # build bootia32.efi
    # build bootx64.efi
# build iso image
# build multiboot core.img
# but WITHOUT ANY WARRANTY; without even the implied warranty of
    case "$option" in
    case "${target_cpu}-${native_platform}" in
    cat <<EOF
    cat << EOF > ${memdisk_dir}/boot/grub/grub.cfg
    cat ${pc_dir}/boot.img ${core_img} > ${embed_img}
    cat ${pc_dir}/cdboot.img ${core_img} > ${iso9660_dir}/boot/grub/i386-pc/eltorito.img
    (cd "${memdisk_dir}"; tar -cf - boot) > "${memdisk_img}"
# Check the arguments.
# Copyright (C) 1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010  Free Software Foundation, Inc.
    coreboot_dir=
coreboot_dir=${libdir}/$(echo ${PACKAGE_TARNAME} | sed ${transform})/i386-coreboot
    core_img=`mktemp "${TMPDIR:-/tmp}/tmp.XXXXXXXXXX"` || exit 1
	cp "${efi_dir}"/efi/boot/bootia32.efi "${efi_dir}"/efi/boot/boot.efi
	    cp -f "$file" ${iso9660_dir}/boot/grub/locale/
            cp -f "$file" ${iso9660_dir}/boot/grub/${platform}/
            cp -f "${input_dir}/${file}" ${iso9660_dir}/boot/grub/${platform}/
    cp "${iso9660_dir}/boot/coreboot.elf" "${rom_directory}/coreboot.elf"
    cp "${iso9660_dir}/boot/qemu.img" "${rom_directory}/qemu.img"
datarootdir="${prefix}/share"
    --diet)
  --diet                  apply size reducing measures [optional]
	diet=yes ;;
directories, or mkisofs options listed by: xorriso -as mkisofs -help
    done
    done ; \
      echo "$0: option requires an argument -- '$opt'" 1>&2
  echo $1
    echo "$1: Not found." 1>&2
    echo "Enabling $2 support ..."
    echo "Enabling BIOS support ..."
        echo "insmod $i"
  echo "output file must be given" >&2
	echo "$self (${PACKAGE_NAME}) ${PACKAGE_VERSION}"
    echo "source /boot/grub/grub.cfg") \
    efi32_dir=
efi32_dir=${libdir}/$(echo ${PACKAGE_TARNAME} | sed ${transform})/i386-efi
    efi64_dir=
efi64_dir=${libdir}/$(echo ${PACKAGE_TARNAME} | sed ${transform})/x86_64-efi
    efi_dir=`mktemp -d "${TMPDIR:-/tmp}/tmp.XXXXXXXXXX"` || exit 1
		--embedded-boot ${embed_img}"
    embed_img=`mktemp "${TMPDIR:-/tmp}/tmp.XXXXXXXXXX"` || exit 1
    esac
exec_prefix="${prefix}"
	exit 0 ;;
      exit 1
    exit 1
  exit 1
	export PATH
        fi
    for file in "${input_dir}/"*.mod "${input_dir}/"efiemu32.o "${input_dir}/"efiemu64.o; do
    for file in ${input_dir}/po/*.mo; do
    for file in ${pkglib_DATA}; do
    (for i in $(cat ${pc_dir}/partmap.lst) ${modules} ; do
    (for i in $(cat ${source_directory}/partmap.lst) ${modules} ; do
        # For old macs. Suggested by Peter Jones.
# GNU General Public License for more details.
# GRUB is distributed in the hope that it will be useful,
# GRUB is free software: you can redistribute it and/or modify
    --grub-mkimage=*)
    --grub-mkimage)
	grub_mkimage=`argument $option "$@"`; shift ;;
grub_mkimage=${bindir}/`echo grub-mkimage | sed ${transform}`
	grub_mkimage=`echo "$option" | sed 's/--grub-mkimage=//'` ;;
  --grub-mkimage=FILE     use FILE as grub-mkimage
    $grub_mkimage -O i386-pc -d ${pc_dir}/ -o ${core_img} --prefix=/boot/grub/i386-pc \
    $grub_mkimage -O ${platform} -d "${source_directory}" -m "${memdisk_img}" -o "$3" --prefix='(memdisk)/boot/grub' \
    grub_mkisofs_arguments="${grub_mkisofs_arguments} -b boot/grub/i386-pc/eltorito.img -no-emul-boot -boot-info-table \
    grub_mkisofs_arguments="${grub_mkisofs_arguments} --efi-boot efi.img"
grub_mkisofs_arguments="${grub_mkisofs_arguments} --modification-date=$(echo ${iso_uuid} | sed -e s/-//g)"
    -h | --help)
  -h, --help              print this message and exit
        i386-coreboot) coreboot_dir=${override_dir} ;;
	i386-efi) efi32_dir=${override_dir} ;;
        i386-multiboot) multiboot_dir=${override_dir} ;;
        i386-pc) pc_dir=${override_dir} ;;
        i386-qemu) qemu_dir=${override_dir} ;;
if [ "${diet}" = yes ]; then
    if [ -e "${efi_dir}"/efi/boot/bootia32.efi ]; then
if [ -e "${iso9660_dir}/boot/coreboot.elf" ] && [ -d "${rom_directory}" ]; then
if [ -e "${iso9660_dir}/boot/qemu.img" ] && [ -d "${rom_directory}" ]; then
    if [ -e "${output_image}" ]; then
if [ "${override_dir}" = "" ] ; then
    if test -e "${coreboot_dir}" ; then
    if test -e "${efi32_dir}" ; then
if test -e "${efi64_dir}" || test -e "${efi32_dir}"; then
    if test -e "${efi64_dir}" ; then
    if test -e "${multiboot_dir}" ; then
    if test -e "${pc_dir}" ; then
if test -e "${pc_dir}" ; then
  if test $# -eq 0; then
    if test -e "${qemu_dir}" ; then
    if ! test -e "${source_directory}"; then
if test -f "$1"; then
        if test -f "$file"; then
	if test -f "${input_dir}/${file}"; then
if [ "x${output_image}" = x ] ; then
# Initialize some variables.
    input_dir="$1"
    # Intentionally undocumented
        iso9660 biosdisk
    > ${iso9660_dir}/boot/grub/i386-pc/grub.cfg
    > ${iso9660_dir}/boot/grub/${platform}/grub.cfg
iso9660_dir=`mktemp -d "${TMPDIR:-/tmp}/tmp.XXXXXXXXXX"` || exit 1
iso_uuid=$(date -u +%Y-%m-%d-%H-%M-%S-00)
# it under the terms of the GNU General Public License as published by
libdir="${exec_prefix}/lib"
Mail xorriso support requests to <bug-xorriso@gnu.org>.
# Make GRUB rescue image
Make GRUB rescue image.
make_image ()
make_image "${coreboot_dir}" i386-coreboot "${iso9660_dir}/boot/coreboot.elf" "ata at_keyboard"
    make_image "${efi32_dir}" i386-efi "${efi_dir}"/efi/boot/bootia32.efi "part_msdos fat"
    make_image "${efi64_dir}" x86_64-efi "${efi_dir}"/efi/boot/bootx64.efi "part_msdos fat"
make_image "${multiboot_dir}" i386-multiboot "${iso9660_dir}/boot/multiboot.img" "ata at_keyboard"
make_image "${qemu_dir}" i386-qemu "${iso9660_dir}/boot/qemu.img" "ata at_keyboard"
    mcopy -s -i "${iso9660_dir}"/efi.img ${efi_dir}/efi ::/
    memdisk_dir=`mktemp -d "${TMPDIR:-/tmp}/tmp.XXXXXXXXXX"` || exit 1
    memdisk_img=`mktemp "${TMPDIR:-/tmp}/tmp.XXXXXXXXXX"` || exit 1
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    mformat -C -f 2880 -L 16 -i "${iso9660_dir}"/efi.img ::
    mkdir -p "${efi_dir}/efi/boot"
mkdir -p ${iso9660_dir}/boot/grub
    mkdir -p ${iso9660_dir}/boot/grub/locale
    mkdir -p ${iso9660_dir}/boot/grub/${platform}
    mkdir -p ${memdisk_dir}/boot/grub
    --modules=*)
    --modules)
        modules=`argument $option "$@"`; shift ;;
	modules=`echo "$option" | sed 's/--modules=//'` ;;
  --modules=MODULES       pre-load specified modules MODULES
    multiboot_dir=
multiboot_dir=${libdir}/$(echo ${PACKAGE_TARNAME} | sed ${transform})/i386-multiboot
native_platform=pc
# obtain date-based UUID
    -o | --output)
  -o, --output=FILE       save output in FILE [required]
  opt=$1
    option=$1
Option -- switches to native xorriso command mode.
    --output=*)
	output_image=`argument $option "$@"`; shift ;;
	output_image=`echo "$option" | sed 's/--output=//'` ;;
override_dir=
        override_dir=`argument $option "$@"`
	override_dir=`echo "${option}/" | sed 's/--override-directory=//'`
    --override-directory=*)
    --override-directory)
PACKAGE_NAME=GRUB
PACKAGE_TARNAME=grub
PACKAGE_VERSION=1.99-21ubuntu3.9
	PATH=${override_dir}:$PATH
    pc_dir=
pc_dir=${libdir}/$(echo ${PACKAGE_TARNAME} | sed ${transform})/i386-pc
pkglib_DATA="moddep.lst command.lst fs.lst partmap.lst parttool.lst handler.lst video.lst crypto.lst terminal.lst"
    platform="$2"
    platform=$2
prefix="/usr"
# Print the usage.
process_input_dir ()
        process_input_dir ${coreboot_dir} i386-coreboot
        process_input_dir ${efi32_dir} i386-efi
        process_input_dir ${efi64_dir} x86_64-efi
        process_input_dir ${multiboot_dir} i386-multiboot
    process_input_dir ${override_dir} ${target_cpu}-${native_platform}
        process_input_dir ${pc_dir} i386-pc
        process_input_dir ${qemu_dir} i386-qemu
    qemu_dir=
qemu_dir=${libdir}/$(echo ${PACKAGE_TARNAME} | sed ${transform})/i386-qemu
Report bugs to <bug-grub@gnu.org>.
	return;
    rm -f ${core_img}
rm -f ${embed_img}
        rm "${output_image}" || exit 1
    rm -rf ${efi_dir}
rm -rf ${iso9660_dir}
    rm -rf ${memdisk_dir}
    rm -rf ${memdisk_img}
    --rom-directory=*)
    --rom-directory)
rom_directory=
        rom_directory=`argument $option "$@"`; shift ;;
  --rom-directory=DIR     save rom images in DIR [optional]
	rom_directory=`echo "$option" | sed 's/--rom-directory=//'` ;;
search --fs-uuid --set=root ${iso_uuid}
        search iso9660 configfile normal memdisk tar $4
self=`basename $0`
$self generates a bootable rescue image with specified source files, source
set $grub_mkimage dummy
set prefix=(\${root})/boot/grub/${platform}
    shift
    source_directory="$1"
source \$prefix/grub.cfg
	source="${source} ${option} $@"; break ;;
target_cpu=i386
# the Free Software Foundation, either version 3 of the License, or
transform="s,x,x,"
usage () {
Usage: $self [OPTION] SOURCE...
# Usage: usage
    -v | --version)
  -v, --version           print the version information and exit
while test $# -gt 0
	x86_64-efi) efi64_dir=${override_dir} ;;
    --xorriso=*)
    --xorriso)
	xorriso=`argument $option "$@"`; shift ;;
        xorriso=`echo "${option}/" | sed 's/--xorriso=//'` ;;
  --xorriso=FILE          use FILE as xorriso [optional]
    "${xorriso}" -report_about HINT -as mkisofs -graft-points ${grub_mkisofs_arguments} --protective-msdos-label -o ${output_image} -r ${iso9660_dir} --sort-weight 0 / --sort-weight 1 /boot ${source}
    "${xorriso}" -report_about HINT -as mkisofs -graft-points -no-pad ${grub_mkisofs_arguments} --protective-msdos-label -r ${iso9660_dir} --sort-weight 0 / --sort-weight 1 /boot ${source} | cat >"${output_image}"
xorriso=xorriso
# You should have received a copy of the GNU General Public License
