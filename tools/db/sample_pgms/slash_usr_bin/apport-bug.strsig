# AppArmor confinement via this script (LP: #1045986). This can be removed once
# AppArmor supports environment filtering (LP: #1045985)
# Author: Martin Pitt <martin.pitt@ubuntu.com>
#!/bin/sh -e
# bug with it.
# check for X
        "$CLI" "$@"
    CLI="$RET"
# Copyright (C) 2009 Canonical Ltd.
# Determine the most appropriate Apport user interface (GTK/KDE/CLI) and file a
# determine which UIs are available, and where
    done
# do we have a running Gnome/KDE session?
        echo "\$DISPLAY is not set. You need apport-cli to make this program work." >&2
    echo "Neither apport-gtk, apport-kde or apport-cli are installed. Install either to make this program work." >&2
elif pgrep -u `id -u` -x gnome-session >/dev/null && \
elif pgrep -u `id -u` -x ksmserver >/dev/null && \
elif [ -x "$CLI" ]; then
elif [ -x "$GTK" ]; then
elif [ -x "$KDE" ]; then
    else
# ENV and CDPATH. We need do this so that confined applications using
        exit 1
    exit 1
# Explicitly set the PATH to that of ENV_SUPATH in /etc/login.defs and unset
export APPORT_INVOKED_AS="$0"
export CDPATH=
export ENV=
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
# fall back to calling whichever is available
    # find a terminal emulator
find_program() {
    find_program "apport-cli"
    find_program "apport-gtk"
    find_program "apport-kde"
find_programs
find_programs() {
    for p in /usr/local/bin /usr/bin /usr/local/share/apport /usr/share/apport; do
# Free Software Foundation; either version 2 of the License, or (at your
    "$GTK" "$@"
    GTK="$RET"
    if [ -x "$CLI" ] ; then
	if [ -x $p/$1 ]; then
if [ -z "$DISPLAY" ]; then
    if [ -z "$TERM" ] && [ -x "$XTERM" ]; then
    "$KDE" "$@"
    KDE="$RET"
# locate path of a particular program
# option) any later version.  See http://www.gnu.org/copyleft/gpl.html for
	    RET=$p/$1
	    return
# the full text of the license.
# This program is free software; you can redistribute it and/or modify it
# ubuntu-browsers.d/ubuntu-integration cannot abuse the environment to escape
# under the terms of the GNU General Public License as published by the
    unset RET
    [ -x "$GTK" ]; then
    [ -x "$KDE" ]; then
         "$XTERM" -e "$CLI" "$@"
