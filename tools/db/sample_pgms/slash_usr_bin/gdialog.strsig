                }
        }
# Additon by: Kevin C. Krinke (kck) <kckrinke@opendoorsoftware.com>
		# after using height, width and bypassing list-height
		# a gdialog --menu is just a two column zenity --list
	# all is well if we've made it this far
		# also pass a fake NULL argument since zenity can't set
		# and apply the same multipliers as used in gdialog
		# and cDialog. This error, is a very _bad_ error so it's semi-
	# and fork the process
		# and the 'text' arg as a second column header
		# and using the 'item' for display in our second column
		# and we will do the same
		# an untitled column for the check or radio buttons
		# a percentage value was supplied to initialize the
# a problem with the original script
			# are it's the real gdialog and not the Zenity wrapper.
	$argn++;
		$argn++;
		$argn += 1;
			$argn += 1;
		$argn += 2; 
		$argn+=2;
			$argn += 2;
		$argn += 3;
		$argn+=3;
		$argn += 4; 
ARG: while ($argn < $args) {
			# as such is the preference over using the "regular"
# available at http://g-scripts.sourceforge.net - what is sometimes
      BIN: foreach my $PATH (split(/\:/,$PATHS)) {
# but hopefully will translate all the others.
# by Mike Newman <mikegtn@gnome.org>
		# bypassing height, width and list-height
		# cdialog uses 6 height for non-list, zenity uses ~24 pixels
		# cdialog uses 6 width for non-list, zenity uses ~7 pixels
                        # change the command and skip ahead!
# --clear, --backtitle have no obvious effect - ignored
close(ORG_STDERR);
close(ORG_STDOUT);
        @command = ();
                        @command = ($PATH."/dialog");
                        @command = ($PATH."/gdialog.real");
		# Conveniently, zenity and gdialog use the same names
		# default text to initialize the entry with?
		# dialog
			# dialog interface.
		# discarding the 'status' args of each item
		# discard the size args as usually, and see if
# divide by 256.
	$element = $ARGV[$argn];
		$element = $element*24 - 35;
		$element = $element * 7;
		$element = $element*7 - 20;
		$element = $element * 8;
                } elsif (-x $PATH."/dialog") {
# End Addtition by: KCK
		# equivalent to zenity's --text arg.
        # examine all the available/default paths
        exec(@command);
# execute the constructed zenity command line
	exit (1);
                exit(254);
		# exit code 254 is used because 255, 1, 2, 3 are used by Zenity
exit $return;
		# FIXME: or should it be the dialog text, or both?
		# for dialog compatability - which it pretty much ignored
		# for list types, so pass this to zenity intact along with
# For testing purposes, I've used a couple of the nautilus scripts
		# from here args run [tag] [item] ...
		# from here args run [tag] [item] [status] ...
			# gdialog has full support for the Console medium and
		# gdialog is the filename, so pass this to zenity
# gdialog itself supports both the X-Windows interface as well as a console
# gdialog -> zenity conversion wrapper
			get_arg;
		get_arg;
	get_arg;
# Got DISPLAY, has X continue as normal...
		# Height and width in characters to be displayed, so adjust
		# highly hig-norant anyway!
		if ($element) {
	if ($element eq "--checklist" || $element eq "--radiolist") {
	if ($element eq "--gauge") {
	if ($element eq "--help" || $element eq "--about") {
	if ($element eq "--inputbox") {
	if ($element eq "--menu") {
	if ($element eq "--msgbox" || $element eq "--infobox") {
	if ($element eq "--separate-output") {
	if ($element eq "--textbox") {
	if ($element eq "--title") {
	if ($element eq "--yesno") {
		if ($separator) {
                if (-x $PATH."/gdialog.real") {
		"If you are reading this message, you should\n" .
		# ignore size elements and maybe there is some
# Informational stuff
# interface. Here's a fix to use regular dialog when appropriate.
		# keeping 'tag' args of each item (required to return)
		# keep processing args
# know better, please let me know. So for now this works: "no DISPLAY; no X".
		last ARG;
                        last BIN;
		# Leave the first column blank (not provided)
		$list=$element;
		# Loop over the remainder of the commandline
# most commond gdialog types to zenity equivalents. It will mostly drop
my $argn = 0;			# counter for walking args
my $args = $#ARGV + 1;		# total number of command line arguments
my @command = ("zenity");	# the command line we build up to execute
my $element = "";		# current bit of command line
        my $PATHS = ($ENV{'PATH'}||'/bin:/usr/bin:/usr/local/bin:/opt/bin');
my $return = system(@command)/256;
my $separator = 0;		# set if --separate-output is in use
		next ARG;
		# non-standard at 254.
	# notation is saved.
                             " not be found.\n";
# of any other easy way of detecting and X-Windows environment. If someone does
open(ORG_STDERR, ">&STDERR");
open(ORG_STDOUT, ">&STDOUT");
open(STDERR, ">/dev/null");
open(STDERR, ">&ORG_STDERR");
open(STDOUT, ">&ORG_STDERR");
open(STDOUT, ">&ORG_STDOUT");
			# other packages are installed. If this exists, chances
		# per character (default font), and 22 pixels for non-list
# perl doc: The return value of system() is the exit status of the
		# per list entry (default font), and 103 pixels for non-list
	print ( "gdialog is a compatibility wrapper around zenity, " .
                print STDERR "missing DISPLAY and a console dialog could".
		"probably be using zenity directly\n\n" .
#program as returned by the wait() call. To get the actual exit value
		"provided to hopefully\nallow older scripts to run. " .
        push @command, @ARGV;
			push @command, $element;
		push @command, "--entry-text=$element";
		push @command, "--entry", "--text=$element";
		push @command, "--filename=$element";
		push @command, "--height=$element";
		push @command, "--height", $element;
		push @command, "--info", "--text=$element";
		push @command, "--list", "--column", "", "--column", $element;
		push @command, "--list", $list, "--column=''", "--column=''", "--column", $element;
			push @command, "NULL", $element;
			push @command, "--percentage=$element";
		push @command, "--progress", "--text=$element";
		push @command, "--question", "--text=$element";
			push @command, "--separator=\n";
		push @command, "--text-info";
		push @command, "--title=$element";
		push @command, "--width=$element";
		push @command, "--width", $element;
# redirect STDERR to /dev/null (GTK messages ie: 
# redirect STDOUT to STDERR (gdialog direct output to STDERR by default)
        # reset the command string
# restore STDOUT and STDERR
# save STDOUT and STDERR
# Section 1 : Args which gdialog expects BEFORE box options
# Section 2 : Box Options and subsequent args
		$separator = 1;
		# set the flag to pring list output line by line
		# should output be line by line?
		# Skip to the first 'item' arg of the list content
	# so join the arguments double-quoting things so that proper shell
			# Some GNU/Linux distributions divert binaries when
sub get_arg () { 
		# the arg following the dialog type in gdialog is usually
		# the arg immediately following the dialog type in
		# the default button in question dialogs - which is
# the pointless and unused (even by gdialog!) size arguments
		# the status of a row like gdialog can
		# this also happens a lot - gdialog accepted size args
		# This appears to be almost exact
		# This bit is common to almost all of the dialogs
# This is all, of course, horrible - but it should translate
		# This is not exact, but close enough
# this just loads the current arg into $element
# This should probably be a more advanced test of some sort, but I don't know
		# this will silently ignore the gdialog option to set
		# --title argument is almost analogous in gdialog and
		# to STDERR.
		"type: 'zenity --help' or 'man zenity' for more information\n");
# unclear is what is a gdialog/zenity translation problem, and what is
        unless (@command) {
unless (defined $ENV{'DISPLAY'} && length($ENV{'DISPLAY'})) {
		# Use the 'text' arg as a second column header
#!/usr/bin/perl
# walk the command line
		# we didn't find the dialog binary, exit(254) with a message
		while ($argn < $args) {
		# width and height matter for this one, so get them
#  (zenity:637): Gtk-WARNING **: Unable to locate theme engine in module_path: "mist",)
		# zenity - so pass it almost entirely as is
