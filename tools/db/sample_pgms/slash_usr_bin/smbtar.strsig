      ;;
	[0-9]*) ;;
   a) # [a]rchive
#          and Ricky Poulten (ricky@logcam.co.uk)
   '?') # any other switch
  -a             Reset archive bit mode        Don't reset archive bit
# Authors: Martin.Kraemer <Martin.Kraemer@mch.sni.de>
  -b <blocksize> Specify tape's blocksize      `set -- $blocksize; echo $2`
# being backed up.
#!/bin/sh
blocksize=""
blocksizearg=""
      blocksizearg="b"
      blocksize="$OPTARG"
   b) # specify [b]locksize
case $0 in
  case $c in
      case "$OPTARG" in
cdcmd="\\"
      cdcmd="$OPTARG"
clientargs="-c 'tarmode full'"
      clientargs="-c 'tarmode inc'"
  -d <dir>       Specify a directory in share  $cdcmd
# DEC OSF AKA Digital UNIX does not seem to return a value in OPTIND if 
   d) # specify [d]irectory to change to in server's share
  echo >&2 "$@"
	*)      echo >&2 "$0: Error, block size not numeric: -b $OPTARG"
	*)      echo >&2 "$0: Error, log level not numeric: -l $OPTARG"
	echo >&2 $0: Warning, $OPTARG not found
echo >&2 "Usage: `basename $0` [<options>] [<include/exclude files>]
      echo "blocksize is $blocksize"
# echo Params count: $#
#     echo "password  is $password"  # passwords should never be sent to screen
      echo "server    is $server"
#     echo "share     is $service"
      echo "tape      is $tapefile"
      echo "tar args  is $tarargs"
-E $log -D "'$cdcmd'" ${clientargs} \
      else
      esac
eval $SMBCLIENT "'\\\\$server\\$service'" "'$password'" -U "'$username'" \
    ex=$1
		exit 1
  exit $ex
      fi
# fix a bug in clitar when a patch was added to stop system and hidden files
Function: backup/restore a Windows PC directories to a local tape file
if [ $# = 0 ]; then
      if [ -f $OPTARG ]; then
if [ "$server" = "" ] || [ "$service" = "" ]; then
# if the -v switch is set, the echo the current parameters
if [ -z "$verbose" ]; then
   i) # [i]ncremental
  -i             Incremental mode              Full backup mode
  -l <log>       Specify a Samba Log Level     `set -- $log; echo $2`
log="-d 2"
      log="-d $OPTARG"
   l) # specify [l]og file
# (May need to change shell to ksh for HPUX or OSF for better getopts)
   N) # compare with a file, test if [n]ewer
newer=""
newerarg=""
	newerarg="N"
	newer=$OPTARG
  -N <newer>     File for date comparison      `set -- $newer; echo $2`
Options:         (Description)                 (Default)
password=""
      password="$OPTARG"
  -p <password>  Specify PC Password           $password
      printf "share     is %s\\%s\n" "$service" "$cdcmd"
   p) # specify [p]assword to use
# Richard Sharpe, added -c 'tarmode full' so that we back up all files to
  -r             Restore from tape file to PC  Save from PC to tapefile
   r) # [r]estore to Windows (instead of the default "Save from Windows")
# sandy nov 3 '98 added -a flag
server=""
      server="$OPTARG"
service="backup"            # Default: a service called "backup"
      service="$OPTARG"
    shift
shift `expr $OPTIND - 1`
	SMBCLIENT="`dirname $0`/smbclient";;
	SMBCLIENT="smbclient";;
# smbtar script - front end to smbclient
  -s <server>    Specify PC Server             $server
   s) # specify [s]erver's share to connect to - this MUST be given.
      tapefile="$OPTARG"
tapefile=${TAPE-tar.out}
tarargs=""
      tarargs=${tarargs}a
tarargs=${tarargs}${blocksizearg}${newerarg}
      tarargs=${tarargs}ga
      tarargs=${tarargs}X
tarcmd="c"
      tarcmd="x"
# there are no command line params, so protect us against that ...
# These are the default values. You could fill them in if you know what
   t) # specify [t]apefile on local host
  -t <tape>      Specify Tape device           $tapefile
-T${tarcmd}${tarargs} $blocksize $newer $tapefile '${1+"$@"}' $verbose
Usage(){
  Usage 1 "No server or no service specified - abort."
       Usage 2 "Invalid switch specified - abort."
  Usage 2 "Please enter a command line parameter!"
username=$LOGNAME           # Default: same user name as in *nix
      username="$OPTARG"
   u) # specify [u]sername for connection
  -u <user>      Specify User Name             $username
   v) # be [v]erbose and display what's going on
      verbose=""
verbose="2>/dev/null"        # Default: no echo to stdout
  -v             Verbose mode: echo command    Don't echo anything
    # when called by absolute path, assume smbclient is in the same directory
while getopts riavl:b:d:N:s:p:x:u:Xt: c; do
   X) # Add exclude flag
  -X             Exclude mode                  Include
  -x <share>     Specify PC Share              $service
   x) # specify windows [s]hare to use
    *)  # you may need to edit this to show where your smbclient is
# you're doing, but beware: better not store a plain text password!
