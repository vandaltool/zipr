# (at your option) any later version.
#!/bin/sh
BUNZIP2="/bin/bunzip2"
# but WITHOUT ANY WARRANTY; without even the implied warranty of
CHMOD="/bin/chmod"
    $CHMOD --reference="$FILE" "$NEWFILE"
CHOWN="/bin/chown"
    $CHOWN --reference="$FILE" "$NEWFILE"
# Copyright (C) 2008-2010 Anibal Monsalve Salazar <anibal@debian.org>
    $CURL -o $NEWFILE$EXT $URL$EXT > /dev/null 2>&1
CURL="/usr/bin/curl"
date=$( $GREP -E "^#[[:space:]]Date:[[:space:]]*" $NEWFILE 2> /dev/null | $SED "s/^#[[:space:]]Date:[[:space:]]*//" )
    $ECHO >&2 "update-pciids: cannot find bunzip2 or gunzip"
    $ECHO >&2 "update-pciids: cannot find wget, curl or lynx"
    $ECHO >&2 "update-pciids: missing class info, probably truncated file"
    $ECHO >&2 "update-pciids: missing snapshot date, probably truncated file"
    $ECHO >&2 "update-pciids: $NEWFILE is read-only"
ECHO="/bin/echo"
    $ECHO "Downloaded daily snapshot dated $date"
elif [ -x $CURL ]
elif [ -x $GUNZIP ]
elif [ -x $LYNX ]
    exit 1
    EXT=".bz2"
    EXT=".gz"
FILE=/usr/share/misc/pci.ids
[ -f $NEWFILE.bz2 ] && $RM $NEWFILE.bz2
[ -f $NEWFILE.gz ]  && $RM $NEWFILE.gz
[ -f $NEWFILE ]     && $RM $NEWFILE
    [ -f $OLDFILE.gz ] && $RM $OLDFILE.gz
    [ -f $OLDFILE ] && $RM $OLDFILE
# GNU General Public License for more details.
# (GPL) version 2 or above.
GREP="/bin/grep"
GUNZIP="/bin/gunzip"
# http://www.gnu.org/licenses/gpl.html, for information about the GPL.
if [ "$1" = "-q" ]
if [ -f $FILE ]
if [ -f $FILE.gz ]
if ! $GREP > /dev/null "^C " $NEWFILE
if [ $quiet = "no" ]
if ! $TOUCH $NEWFILE > /dev/null 2>&1
if [ -x $BUNZIP2 ]
if [ -x $WGET ]
if [ -z "$date" ]
# it under the terms of the GNU General Public License as published by
    $LYNX -source $URL$EXT > $NEWFILE$EXT
LYNX="/usr/bin/lynx"
# Martin Mares.
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
MV="/bin/mv"
    $MV $FILE.gz $OLDFILE.gz
    $MV $FILE $OLDFILE
$MV $NEWFILE $FILE
NEWFILE="$FILE.new"
OLDFILE="$FILE.old"
# Please read the "COPYING" file in the archive root, or visit
    quiet="no"
    quiet="yes"
RM="/bin/rm"
$RM $NEWFILE$EXT
SED="/bin/sed"
# the Free Software Foundation, either version 2 of the License, or
# This program is distributed in the hope that it will be useful,
# This program is free software: you can redistribute it and/or modify
# This scipt is a rewrite of a script with the same name by
$TOUCH -d "$date" $FILE
TOUCH="/usr/bin/touch"
    UNZIP=$BUNZIP2
    UNZIP=$GUNZIP
$UNZIP < $NEWFILE$EXT > $NEWFILE
# update-pciids.sh is licensed under the GNU General Public License
URL="http://pciids.sourceforge.net/v2.2/pci.ids"
#URL="http://pci-ids.ucw.cz/pci.ids"
    $WGET -nv -O $NEWFILE$EXT $URL$EXT > /dev/null 2>&1
WGET="/usr/bin/wget"
